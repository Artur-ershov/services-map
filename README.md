# КРОК СЕРВИСЫ - Модуль карты этажей

## Контекст проекта

Этот проект представляет собой интерактивный модуль карты этажей зданий для отображения сервисов и помещений. Модуль разрабатывается для интеграции в **Tilda** (конструктор сайтов).

## Важные заметки

### Временный фикс для шрифтов

**ВАЖНО: Файл `tmp.css` НЕ УДАЛЯТЬ!**

Файл `tmp.css` содержит временный фикс для подключения шрифтов:
- Использует `!important` для переопределения `font-family` на всех элементах
- Подключает локальный шрифт `CoFoWeather20240219-VF.ttf` для локального просмотра
- Это необходимо для корректной работы шрифтов в контексте Tilda
- В Tilda шрифт будет задан отдельно, но для локальной разработки нужен `tmp.css`
- **НЕ УДАЛЯТЬ** - используется для локального просмотра с правильным шрифтом

### Структура файлов

- `index.html` - основная разметка модуля
- `style.css` - основные стили модуля
- `tmp.css` - временные стили для шрифтов (см. выше)
- `app.js` - логика модуля (фильтрация, карта, взаимодействие)
- `data.js` - данные о сервисах и этажах
- `floor-*.svg` - SVG карты этажей

### CSS переменные

Модуль использует CSS переменные для корпоративных цветов:
- `--krok-green`, `--krok-blue`, `--krok-purple`, `--krok-red`, `--krok-orange`
- RGB версии для использования в `rgba()`: `--krok-*-rgb`

## Запуск локального сервера

Для разработки и тестирования модуля используется команда `srv`:

```bash
srv
```

Сервер запустится на `http://localhost/` (порт 80) с автоматической перезагрузкой страницы при изменении файлов (livereload).

**Важно:** При использовании livereload временно отключены debug-логи с `fetch()` запросами, чтобы избежать постоянных перезагрузок страницы.

## Интеграция в Tilda

При интеграции в Tilda необходимо:
1. Убедиться, что все CSS файлы загружаются в правильном порядке
2. Проверить, что шрифты доступны (или использовать `tmp.css`)
3. Убедиться, что модуль изолирован от стилей Tilda (используется `#krok-services-map-module`)

## Интеграция с Figma

Проект поддерживает синхронизацию планов этажей из Figma через MCP (Model Context Protocol).

### Структура интеграции

- `figma-config.js` - конфигурация для связи этажей с Figma node IDs
- `scripts/figma-sync-helper.js` - вспомогательные функции для работы с Figma
- `scripts/export-floor-from-figma.js` - скрипт для экспорта этажей

### Настройка конфигурации

1. Откройте `figma-config.js`
2. Убедитесь, что `fileKey` соответствует вашему Figma файлу
3. Добавьте маппинг этажей в `floorMapping`:
   ```javascript
   'B1-F3': {
       nodeId: '72:24', // Node ID из Figma URL
       building: 'B1',
       floor: 3,
       fileName: 'floor-B1-F3.svg'
   }
   ```

### Получение Node ID из Figma

1. Откройте нужный этаж в Figma
2. Скопируйте URL (например: `https://www.figma.com/design/...?node-id=72-24`)
3. Извлеките node ID (в примере: `72:24` или `72-24` - замените дефис на двоеточие)

### Использование MCP инструментов

Для экспорта SVG из Figma используйте доступные MCP инструменты:
- `mcp_Figma_get_design_context` - для получения SVG кода
- `mcp_Figma_get_metadata` - для получения структуры
- `mcp_Figma_get_screenshot` - для получения скриншота

**Примечание:** MCP инструменты должны быть доступны через соответствующий MCP сервер.

