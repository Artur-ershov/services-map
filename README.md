# КРОК СЕРВИСЫ - Модуль карты этажей

## Контекст проекта

Этот проект представляет собой интерактивный модуль карты этажей зданий для отображения сервисов и помещений. Модуль разрабатывается для интеграции в **Tilda** (конструктор сайтов).

## Важные заметки

### Временный фикс для шрифтов

Файл `tmp.css` содержит временный фикс для подключения шрифтов:
- Использует `!important` для переопределения `font-family` на всех элементах
- Это необходимо для корректной работы шрифтов в контексте Tilda
- **НЕ УДАЛЯТЬ** без замены на постоянное решение

### Структура файлов

- `index.html` - основная разметка модуля
- `style.css` - основные стили модуля
- `tmp.css` - временные стили для шрифтов (см. выше)
- `app.js` - логика модуля (фильтрация, карта, взаимодействие)
- `data.js` - данные о сервисах и этажах
- `floor-*.svg` - SVG карты этажей (будут добавлены)
- `CoFoWeather20240219-VF.ttf` - шрифт модуля

### CSS переменные

Модуль использует CSS переменные для корпоративных цветов:
- `--krok-green`, `--krok-blue`, `--krok-purple`, `--krok-red`, `--krok-orange`
- RGB версии для использования в `rgba()`: `--krok-*-rgb`
- Цвета зон: `--zone-meeting`, `--zone-food`, `--zone-sport`, `--zone-relax`, `--zone-service`
- Прозрачность зон: `--zone-opacity-idle`, `--zone-opacity-active`, `--zone-opacity-dimmed`

## Структура данных

### Корпуса и этажи

Модуль поддерживает 3 корпуса (B1, B2, B3) по 10 этажей в каждом (всего 30 этажей).

Структура данных в `data.js`:
- `buildingFloorStructure` - определение корпусов и этажей
- `allServices` - массив всех сервисов с привязкой к корпусу и этажу
- `areaDefinitions` - определения областей на картах этажей

### Категории сервисов

- `meeting` - Переговорки (зеленый)
- `food` - Питание (оранжевый)
- `sport` - Спорт (фиолетовый)
- `relax` - Релакс (красный)
- `service` - Сервисы (синий)

## Функциональность

### Основные возможности

1. **Переключение этажей** - выпадающий список в заголовке панели
2. **Фильтрация** - по категориям и подфильтрам
3. **Поиск** - по названию и описанию сервисов
4. **Поиск на всех этажах** - автоматически показывает сервисы с других этажей при активной категории или поиске
5. **Интерактивная карта** - панорамирование и зум (мышь и touch)
6. **Popup с информацией** - детальная информация о сервисе
7. **Сохранение состояния** - фильтры и поиск сохраняются в localStorage

## Запуск локального сервера

Для разработки и тестирования модуля используется команда `srv`:

```bash
srv
```

Сервер запустится на `http://localhost/` (порт 80) с автоматической перезагрузкой страницы при изменении файлов (livereload).

## Интеграция в Tilda

### Шаги интеграции

1. **Загрузка файлов:**
   - Загрузите все файлы проекта в Tilda (через HTML-блок или файловый менеджер)
   - Убедитесь, что пути к файлам корректны

2. **Порядок загрузки CSS:**
   ```
   style.css
   tmp.css (если нужен фикс для шрифтов)
   ```

3. **Порядок загрузки JS:**
   ```
   data.js
   app.js
   ```

4. **Изоляция стилей:**
   - Модуль использует `#krok-services-map-module` для изоляции стилей
   - Все стили применяются только внутри этого контейнера
   - Проверьте, что нет конфликтов с другими блоками Tilda

5. **Шрифты:**
   - Загрузите `CoFoWeather20240219-VF.ttf` в Tilda
   - Используйте `tmp.css` для корректной работы шрифтов

6. **SVG карты:**
   - Загрузите все файлы `floor-*.svg` для этажей
   - Убедитесь, что пути в `data.js` корректны

### Проверка после интеграции

- [ ] Все стили применяются корректно
- [ ] Шрифты отображаются правильно
- [ ] Карты этажей загружаются
- [ ] Фильтрация и поиск работают
- [ ] Touch-события работают на мобильных
- [ ] Popup отображается корректно
- [ ] Нет конфликтов с другими блоками Tilda

## Технические детали

### Поддерживаемые браузеры

- Chrome (последняя версия)
- Firefox (последняя версия)
- Safari (последняя версия)
- Edge (последняя версия)

### Адаптивность

Модуль адаптирован для:
- Десктоп (от 1024px)
- Планшеты (768px - 1023px)
- Мобильные устройства (до 767px)

### Accessibility

- ARIA-атрибуты для всех интерактивных элементов
- Клавиатурная навигация (Tab, Enter, Space, Escape)
- Focus-стили для всех элементов
- Семантическая разметка

## Разработка

### Структура кода

- `app.js` - основной файл с логикой модуля
- Все функции обернуты в IIFE для изоляции
- Используются глобальные переменные из `data.js`

### Добавление новых этажей

1. Обновите `buildingFloorStructure` в `data.js`
2. Добавьте определения областей в `areaDefinitions`
3. Добавьте сервисы в `allServices` с правильными `building` и `floor`
4. Загрузите SVG файл карты этажа

