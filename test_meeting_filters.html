<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест фильтров переговорных</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h2 {
            margin-top: 0;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Тест фильтров для переговорных</h1>
    
    <div class="test-section">
        <h2>1. Проверка данных в data.js</h2>
        <div id="data-check"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Проверка определения фильтров в app.js</h2>
        <div id="filter-def-check"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Симуляция работы renderSubfilters</h2>
        <div id="render-sim"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Рекомендации</h2>
        <div id="recommendations"></div>
    </div>

    <script src="data.js"></script>
    <script>
        // Проверка данных
        const meetingServices = allServices.filter(s => s.category === 'meeting');
        const withCapacity = meetingServices.filter(s => s.attributes && s.attributes.capacity);
        const withEquipment = meetingServices.filter(s => s.attributes && s.attributes.equipment);
        const withLocation = meetingServices.filter(s => s.attributes && s.attributes.location);
        
        let html = `<div class="result info">
            <strong>Всего переговорных:</strong> ${meetingServices.length}<br>
            <strong>С capacity:</strong> ${withCapacity.length}<br>
            <strong>С equipment:</strong> ${withEquipment.length}<br>
            <strong>С location:</strong> ${withLocation.length}
        </div>`;
        
        if (withCapacity.length > 0) {
            html += `<div class="result success">✓ Есть данные для capacity</div>`;
            html += `<pre>Примеры: ${withCapacity.slice(0, 5).map(s => s.attributes.capacity).join(', ')}</pre>`;
        } else {
            html += `<div class="result error">✗ Нет данных для capacity</div>`;
        }
        
        if (withEquipment.length > 0) {
            html += `<div class="result success">✓ Есть данные для equipment</div>`;
            html += `<pre>Примеры: ${withEquipment.slice(0, 5).map(s => s.attributes.equipment).join(', ')}</pre>`;
        } else {
            html += `<div class="result error">✗ Нет данных для equipment</div>`;
        }
        
        if (withLocation.length > 0) {
            html += `<div class="result info">ℹ Есть данные для location (${withLocation.length} записей)</div>`;
            html += `<pre>Примеры: ${[...new Set(withLocation.slice(0, 10).map(s => s.attributes.location))].join(', ')}</pre>`;
        }
        
        document.getElementById('data-check').innerHTML = html;
        
        // Проверка определения фильтров
        const subfilterDefinitions = {
            'food': ['hours'],
            'sport': ['access'],
            'meeting': ['capacity', 'equipment'],
            'relax': ['type'],
            'service': ['hours']
        };
        
        const subfilterLabels = {
            'hours': 'Часы работы',
            'access': 'Доступ',
            'capacity': 'Вместимость',
            'equipment': 'Оборудование',
            'type': 'Тип',
            'location': 'Номер помещения'
        };
        
        html = `<div class="result info">
            <strong>Определенные фильтры для meeting:</strong> ${subfilterDefinitions['meeting'].join(', ')}<br>
            <strong>Метки:</strong> ${subfilterDefinitions['meeting'].map(k => subfilterLabels[k] || k).join(', ')}
        </div>`;
        
        document.getElementById('filter-def-check').innerHTML = html;
        
        // Симуляция renderSubfilters
        function simulateRenderSubfilters(category) {
            const definition = subfilterDefinitions[category];
            if (!definition) return [];
            
            const results = [];
            definition.forEach(attrKey => {
                const allValues = meetingServices
                    .filter(s => s.category === category && s.attributes && s.attributes[attrKey])
                    .map(s => s.attributes[attrKey]);
                const uniqueValues = [...new Set(allValues)].sort();
                
                results.push({
                    key: attrKey,
                    label: subfilterLabels[attrKey] || attrKey,
                    uniqueValues: uniqueValues,
                    count: uniqueValues.length
                });
            });
            
            return results;
        }
        
        const simulated = simulateRenderSubfilters('meeting');
        html = '<div class="result info"><strong>Результат симуляции renderSubfilters для meeting:</strong></div>';
        
        if (simulated.length === 0) {
            html += '<div class="result error">✗ Не будет отображено ни одного подфильтра (нет данных)</div>';
        } else {
            simulated.forEach(result => {
                if (result.count > 0) {
                    html += `<div class="result success">
                        ✓ <strong>${result.label}</strong>: ${result.count} уникальных значений<br>
                        <pre>${result.uniqueValues.slice(0, 10).join(', ')}${result.uniqueValues.length > 10 ? '...' : ''}</pre>
                    </div>`;
                } else {
                    html += `<div class="result error">
                        ✗ <strong>${result.label}</strong>: нет данных, подфильтр не будет отображен
                    </div>`;
                }
            });
        }
        
        document.getElementById('render-sim').innerHTML = html;
        
        // Рекомендации
        html = '<ul>';
        if (withCapacity.length === 0 && withEquipment.length === 0) {
            html += '<li class="result error"><strong>Проблема:</strong> В данных нет capacity и equipment для переговорных</li>';
            html += '<li class="result info"><strong>Решение 1:</strong> Изменить фильтры на location (если это приемлемо)</li>';
            html += '<li class="result info"><strong>Решение 2:</strong> Добавить данные capacity и equipment в data.js</li>';
        } else {
            html += '<li class="result success">✓ Данные есть, фильтры должны работать</li>';
        }
        html += '<li class="result info">Текущее поведение: подфильтры не отображаются, если нет данных (это правильно)</li>';
        html += '</ul>';
        
        document.getElementById('recommendations').innerHTML = html;
    </script>
</body>
</html>

