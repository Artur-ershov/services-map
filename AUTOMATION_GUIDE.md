# Руководство по автоматизации синхронизации

## Обзор

Система автоматизации синхронизации между CSV таблицей, Figma и data.js.

## Процесс автоматизации

### Шаг 1: Обновление CSV таблицы

1. Откройте CSV таблицу (Excel/Google Sheets)
2. Заполните данные о сервисах
3. Сохраните как CSV

**Важно:** 
- Поле "Локация" используется для генерации `areaId`
- Если локация указана (например, "108"), areaId будет `area_108`
- Если локации нет, используется нормализованное название

### Шаг 2: Автоматическая синхронизация CSV → data.js

Запустите скрипт синхронизации:

```bash
node scripts/sync-csv-to-data.js "путь/к/csv-файлу.csv"
```

**Что делает скрипт:**
1. Читает CSV таблицу
2. Нормализует данные (корпуса, категории)
3. Генерирует `data-generated.js` со всеми сервисами
4. Создает `figma-mapping.csv` для Figma

**Пример:**
```bash
node scripts/sync-csv-to-data.js "c:\Users\Admin\Downloads\карта сервисов рабочая таблица.xlsx - Sheet1.csv"
```

### Шаг 3: Проверка сгенерированных файлов

1. **data-generated.js** - обновленная версия data.js
   - Проверьте, что все сервисы корректны
   - Проверьте areaId - они должны соответствовать ID в Figma/SVG

2. **figma-mapping.csv** - маппинг для Figma
   - Содержит рекомендации по переименованию слоев
   - Используйте для согласования с дизайнерами

### Шаг 4: Применение изменений

#### Обновление data.js

```bash
# Сделайте бэкап текущего data.js
copy data.js data-backup.js

# Замените на сгенерированный (если всё ОК)
copy data-generated.js data.js
```

#### Работа с Figma

**Автоматизация через Figma Plugin API:**
- К сожалению, публичный Figma API не поддерживает переименование слоев
- Нужно либо:
  1. Использовать Figma Plugin (требует разработки)
  2. Переименовывать вручную, используя figma-mapping.csv как руководство

**Ручное переименование:**
1. Откройте figma-mapping.csv в Excel/Google Sheets
2. Для каждого сервиса:
   - Найдите соответствующий слой в Figma
   - Переименуйте согласно "Рекомендуемый ID слоя"
   - Убедитесь, что ID слоя = areaId из data.js

### Шаг 5: Синхронизация SVG файлов

После переименования в Figma:
1. Экспортируйте обновленные SVG файлы
2. Сохраните в папку `map/`
3. Обновите `svgFloorPlans` в data.js

## Структура файлов

```
scripts/
  ├── sync-csv-to-data.js      # Главный скрипт синхронизации
  ├── analyze-csv-mapping.js   # Анализ CSV (опционально)
  └── ...

data-generated.js               # Сгенерированный data.js (не перезаписывать data.js автоматически!)
figma-mapping.csv              # Маппинг для Figma
figma-mapping.json             # JSON версия маппинга
```

## Маппинг данных

### Корпуса

| CSV | data.js |
|-----|---------|
| Альфа | B1 |
| Бета | B2 |
| Парковка | PARKING |

### Категории

| CSV | data.js |
|-----|---------|
| Переговорные | meeting |
| Питание | food |
| Сервис | service |
| Эко-инициативы | eco |
| Релакс | relax |
| Спорт | sport |
| Здоровье | health |
| Красота | beauty |
| Без категории | other |

### Генерация areaId

**Если есть локация:**
- Локация: "108" → areaId: `area_108`
- Локация: "3Б" → areaId: `area_3Б`
- Локация: "402 Б" → areaId: `area_402-Б`

**Если локации нет:**
- Название: "КРОК кофе" → areaId: `service_КРОК-кофе`

## Автоматизация переименования в Figma

### Вариант 1: Figma Plugin (рекомендуется)

Для полной автоматизации нужен Figma Plugin, который:
1. Читает figma-mapping.csv или JSON
2. Находит слои по текущим именам/ID
3. Переименовывает согласно маппингу
4. Создает структуру папок

**Требования:**
- Разработка Figma Plugin (JavaScript/TypeScript)
- Доступ к Figma Plugin API

### Вариант 2: Скрипт для экспорта структуры

Можно создать скрипт, который:
1. Читает структуру из Figma через API
2. Сравнивает с figma-mapping.csv
3. Генерирует инструкции для переименования

**Ограничения:**
- Figma API не поддерживает изменение структуры
- Можно только читать и генерировать инструкции

### Вариант 3: Ручное переименование с помощью маппинга

Используйте figma-mapping.csv как руководство:
1. Откройте в Excel/Google Sheets
2. Отсортируйте по корпусу/этажу
3. Переименуйте слои в Figma согласно рекомендациям

## Часто задаваемые вопросы

### Q: Как обновить data.js после изменения CSV?

A: Просто запустите скрипт синхронизации заново:
```bash
node scripts/sync-csv-to-data.js "путь-к-csv"
```

### Q: Что делать, если areaId не совпадает с ID в Figma?

A: Вам нужно:
1. Согласовать ID с дизайнерами
2. Либо обновить CSV (добавить колонку "areaId в Figma")
3. Либо обновить data.js вручную после синхронизации

### Q: Можно ли автоматически переименовать слои в Figma?

A: Через публичный API - нет. Нужен Figma Plugin для автоматизации.

### Q: Как синхронизировать изменения обратно в CSV?

A: Это односторонняя синхронизация (CSV → data.js). Для обратной синхронизации нужен отдельный скрипт.

## Рекомендации

1. **Всегда делайте бэкап** перед заменой data.js
2. **Проверяйте data-generated.js** перед применением
3. **Используйте версионный контроль** (Git) для отслеживания изменений
4. **Согласуйте ID** с дизайнерами перед массовым переименованием
5. **Документируйте изменения** в структуре

## Дальнейшее развитие

### Возможные улучшения:

1. **Двусторонняя синхронизация:** CSV ↔ data.js
2. **Figma Plugin:** для автоматического переименования слоев
3. **Валидация данных:** проверка корректности перед синхронизацией
4. **Конфликты:** обработка конфликтов при синхронизации
5. **История изменений:** отслеживание изменений в данных






