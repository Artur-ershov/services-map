# Получение файлов Tilda через API и автоматическая синхронизация

## Настройка Tilda API

### 1. Получение ключей API

1. Войдите в личный кабинет Tilda
2. Перейдите в **Настройки сайта → Экспорт → API**
3. Скопируйте **Public Key** и **Secret Key**
4. Сохраните их в файл `.env` (см. ниже)

### 2. Получение Project ID

1. В настройках сайта найдите **Project ID** (обычно это число, например `123456`)
2. Или используйте скрипт `get-project-id.js` для автоматического получения

### 3. Настройка путей для экспорта

В настройках Tilda API укажите пути для файлов:
- **export_imgpath**: `/images` (или `/img`)
- **export_jspath**: `/js`
- **export_csspath**: `/css`

## Структура файлов

После синхронизации файлы будут сохранены в:

```
tilda-files/
├── js/              # JavaScript файлы Tilda
│   ├── t-store.js   # Файл корзины (важно для интеграции!)
│   ├── t-cart.js
│   └── ...
├── css/             # CSS файлы
├── images/          # Изображения
└── pages/           # HTML страницы
    ├── page-1001.html
    └── ...
```

## Использование

### Первоначальная синхронизация

```bash
# Установите зависимости
npm install

# Создайте .env файл с ключами
cp .env.example .env
# Отредактируйте .env и добавьте ваши ключи

# Запустите синхронизацию
node scripts/download-tilda-files.js
```

### Автоматическая синхронизация через Webhook

1. Настройте webhook в Tilda:
   - **Настройки сайта → Экспорт → API → Webhook URL**
   - Укажите: `http://ваш-сервер.com/tilda-webhook` (или используйте локальный сервер)

2. Запустите webhook сервер:
```bash
node scripts/tilda-webhook-server.js
```

3. При каждом изменении и публикации в Tilda будет автоматически запускаться синхронизация

## Важные файлы для интеграции с буфетом

После синхронизации изучите следующие файлы:

- `tilda-files/js/t-store.js` - основной файл магазина
- `tilda-files/js/t-cart.js` - файл корзины
- `tilda-files/js/t-product.js` - файл товаров

Эти файлы содержат API для работы с корзиной и товарами.

## Примеры использования API корзины

После изучения файлов вы сможете использовать:

```javascript
// Пример (после изучения реальных файлов)
// Слушаем события добавления в корзину
document.addEventListener('tilda:cart:add', function(e) {
    const product = e.detail.product;
    // Получаем данные о калориях из товара
    const nutrition = extractNutrition(product);
    // Добавляем в дневник
    addToDiary(product, nutrition);
});
```

## Обновление после изменений

После изменений в Tilda:
1. Опубликуйте страницу в Tilda
2. Webhook автоматически запустит синхронизацию
3. Или запустите вручную: `node scripts/download-tilda-files.js`
